<html>

<head>
    <style>
        .cell {
            display: inline-block;
            border: 1px solid #b0b0b0;
            background: #eee;
            width: 20px;
            height: 20px;
            margin: 1;
        }

        .cell.fig {
            background-color: #088;
        }

        .cell.fig.center {
            background-color: #aa0;
        }
    </style>
</head>

<body>
    <div style="display: flex;justify-content: center;">
        <div id="board">
        </div>
    </div>

    <script>
        const boardWidth = 4;
        const boardHeight = 4;

        let fx = 1;
        let fy = 1;


        let figures = [
            //O#O 
            // O
            [{ "x": 0, "y": 0 }, { "x": -1, "y": 0 }, { "x": 1, "y": 0 }, { "x": 0, "y": 1 }], [{ "x": 0, "y": 0 }, { "x": 0, "y": -1 }, { "x": -1, "y": 0 }, { "x": 0, "y": 1 }], [{ "x": 0, "y": 0 }, { "x": 0, "y": -1 }, { "x": -1, "y": 0 }, { "x": 1, "y": 0 }], [{ "x": 0, "y": 0 }, { "x": 0, "y": -1 }, { "x": 1, "y": 0 }, { "x": 0, "y": 1 }]
        ];
        let figView = 0;


        const boardEl = document.getElementById('board');
        createBoard();

        paintFig(fx, fy, figView);

        document.addEventListener('keyup', e => {
            eraseFig(fx, fy, figView);
            if (e.code === 'ArrowLeft' && canMove(fx - 1, fy, figView)) fx--;
            if (e.code === 'ArrowRight' && canMove(fx + 1, fy, figView)) fx++;
            if (e.code === 'ArrowUp' && canMove(fx, fy - 1, figView)) fy--;
            if (e.code === 'ArrowDown' && canMove(fx, fy + 1, figView)) fy++;
            if (e.code === 'Space' && canMove(fx, fy, incFigView(figView))) figView = incFigView(figView);
            paintFig(fx, fy, figView);
            console.log(e.code, fx, fy, figView);
        });


        function incFigView(view) {
            return (view + 1) % 4;
        }
        function paintFig(x, y, view) {
            const fig = figures[view];
            for (let i = 0; i < fig.length; i++) {
                const nx = x + fig[i].x;
                const ny = y + fig[i].y;
                setClass(nx, ny, i === 0 ? 'fig center' : 'fig');
            }
        }

        function eraseFig(x, y, view) {
            const fig = figures[view];
            for (let i = 0; i < fig.length; i++) {
                const nx = x + fig[i].x;
                const ny = y + fig[i].y;
                setClass(nx, ny, '');
            }
        }

        function canMove(x, y, view) {
            const fig = figures[view];
            for (let i = 0; i < fig.length; i++) {
                const nx = x + fig[i].x;
                const ny = y + fig[i].y;
                if (nx < 0 || nx >= boardWidth)
                    return false;
                if (ny < 0 || ny >= boardHeight)
                    return false;
            }
            return true;
        }

        function setClass(x, y, className) {
            boardEl.querySelectorAll('.cell')[y * boardWidth + x].className = 'cell ' + className;
        }

        function createBoard() {
            let s = '';
            for (let y = 0; y < boardHeight; y++) {
                for (let x = 0; x < boardWidth; x++) {
                    s += `<div class='cell'></div>`
                }
                s += "<br/>"
            }
            boardEl.innerHTML = s;
        }
    </script>
</body>

</html>